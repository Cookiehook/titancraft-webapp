{% extends 'components/base.html' %}
{% block content %}
    <h2>Add/Modify Stock</h2>
    <form action="{% url 'add_stock' %}" method="post">
        {% csrf_token %}
        <input type="hidden" value="{{ location.id }}" name="location">
        {% if stock_record %}
            <input type="hidden" name="id" value="{{ stock_record.id }}">
        {% endif %}
        <table>
            <tr>
                <td><label for="stock_item">Item for sale: </label></td>
                <td><input size="3" type="number" name="stock_stack_size" id="stock_stack_size"
                           value="{{ stock_record.stock_stack_size }}"></td>
                <td><select class="chosen-select" name="stock_item" id="stock_item" data-placeholder="Choose Item...">
                    <option value=""></option>
                    {% for name in items %}
                        <option value="{{ name }}">{{ name }}
                    {% endfor %}
                </select></td>
            </tr>
            <tr>
                <td><label for="cost_stack_size">Price: </label></td>
                <td><input size="3" type="number" name="cost_stack_size" id="cost_stack_size"
                           value="{{ stock_record.cost_stack_size }}"></td>
                <td>
                    <select class="chosen-select" name="cost_item" id="cost_item" data-placeholder="Choose Item...">
                        <option value=""></option>
                        {% for name in items %}
                            <option value="{{ name }}">{{ name }}
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <td><label for="units">Units Available: </label></td>
                <td><input size="3" type="number" name="units" id="units" value="{{ stock_record.units }}"></td>
            </tr>
        </table>
        <table>
            <tr>
                <td><label for="stock_description">Item description<br><em>(Optional)</em>: </label></td>
                <td><input size="30" type="text" placeholder="Customisations, if any" name="stock_description"
                           id="stock_description" value="{{ stock_record.stock_description }}"></td>
            </tr>
            <tr>
                <td><label for="enchantments">Enchantments: </label></td>
                <td><select class="chosen-select" name="enchantments" id="enchantments"
                            data-placeholder="Choose Enchantment..." multiple>
                    <option value=""></option>
                    {% for enchantment in enchantments %}
                        <option value="{{ enchantment }}">{{ enchantment }}
                    {% endfor %}
                </select></td>
            </tr>
            <tr>
                <td><label for="potions">Potion Effects: </label></td>
                <td><select class="chosen-select" name="potions" id="potions"
                            data-placeholder="Choose Potions..." multiple>
                    <option value=""></option>
                    {% for potion in potions %}
                        <option value="{{ potion }}">{{ potion }}
                    {% endfor %}
                </select></td>
            </tr>
        </table>
        {% if stock_record %}
            <input id="create" class="btn btn-success" type="submit" value="Update">
        {% else %}
            <input id="create" class="btn btn-success" type="submit" value="Create">
        {% endif %}
    </form>
    {% load static %}
    <script src="{% static 'chosen/docsupport/jquery-3.2.1.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'chosen/chosen.jquery.js' %}" type="text/javascript"></script>
    <script src="{% static 'chosen/docsupport/prism.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'chosen/docsupport/init.js' %}" type="text/javascript" charset="utf-8"></script>

    <script>
        $(document).ready(function () {
            {% if stock_record %}
                $('#stock_item').val("{{ stock_record.stock_item.name }}").trigger('chosen:updated');
                $('#cost_item').val("{{ stock_record.cost_item.name }}").trigger('chosen:updated');
            {% else %}
                $('#cost_item').val("Diamond").trigger('chosen:updated');
            {% endif %}

            {% if current_enchantments %}
                $('#enchantments').val({{ current_enchantments }}).trigger('chosen:updated');
            {% endif %}
            {% if current_potions %}
                $('#potions').val({{ current_potions }}).trigger('chosen:updated');
            {% endif %}
        });
    </script>
{% endblock %}
{% load static %}
